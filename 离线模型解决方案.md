# 手机上模型加载不出的解决方案

## 问题原因

在手机上直接打开HTML文件时，face-api.js模型无法从CDN正常加载，主要原因有：

1. 手机浏览器安全策略限制跨域请求
2. CDN访问受限或网络连接不稳定
3. HTTP/HTTPS混合内容问题

## 解决方案

### 方案一：下载模型文件到本地（推荐）

1. **下载模型文件**：
   - 创建一个名为"models"的文件夹，与2.html在同一目录
   - 从以下地址下载模型文件：
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/ssd_mobilenetv1_model-weights_manifest.json
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/ssd_mobilenetv1_model-shard1
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/face_landmark_68_model-weights_manifest.json
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/face_landmark_68_model-shard1
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/face_recognition_model-weights_manifest.json
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/face_recognition_model-shard1
     - https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/face_recognition_model-shard2

2. **修改2.html文件**：
   - 将2.html中的模型URL从CDN改为本地路径
   - 修改后的MODEL_URL应该是："./models"或"models/"

3. **重新发送到手机**：
   - 将整个文件夹（包含2.html和models文件夹）通过微信/QQ发送到手机
   - 或者使用压缩软件打包后发送，然后在手机上解压

### 方案二：使用本地服务器（已尝试但可能需要调整）

1. 确保服务器正确配置了CORS头部
2. 尝试使用不同的端口
3. 检查防火墙设置，确保手机可以访问电脑

### 方案三：使用在线托管平台

1. 将2.html和模型文件上传到以下平台之一：
   - GitHub Pages
   - Netlify
   - Vercel
   - CodeSandbox

2. 使用生成的HTTPS链接在手机上访问

## 实施步骤（详细）

### 下载模型文件的方法

1. **手动下载**：
   - 在电脑浏览器中逐个访问上述模型文件URL
   - 右键选择"另存为"，保存到models文件夹

2. **使用下载工具**：
   - 创建一个download_models.py脚本，自动下载所有模型文件

### 修改2.html文件

在2.html中找到以下代码：
```javascript
const MODEL_URL = "https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/";
```

将其修改为：
```javascript
const MODEL_URL = "./models/";
```

### 创建自动下载脚本

为了方便，您可以创建一个Python脚本自动下载模型文件：

```python
import os
import requests

# 创建models目录
if not os.path.exists('models'):
    os.makedirs('models')

# 模型文件列表
models = [
    "ssd_mobilenetv1_model-weights_manifest.json",
    "ssd_mobilenetv1_model-shard1",
    "face_landmark_68_model-weights_manifest.json",
    "face_landmark_68_model-shard1",
    "face_recognition_model-weights_manifest.json",
    "face_recognition_model-shard1",
    "face_recognition_model-shard2"
]

base_url = "https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights/"

# 下载每个模型文件
for model in models:
    url = base_url + model
    response = requests.get(url)
    if response.status_code == 200:
        with open(os.path.join('models', model), 'wb') as f:
            f.write(response.content)
        print(f"已下载: {model}")
    else:
        print(f"下载失败: {model} (状态码: {response.status_code})")

print("模型下载完成!")
```

运行此脚本将自动下载所有需要的模型文件到本地models文件夹。

## 注意事项

1. **文件路径**：
   - 确保models文件夹与2.html在同一级目录
   - 如果使用微信/QQ发送，确保文件夹结构保持不变

2. **浏览器兼容性**：
   - 推荐使用Chrome或Firefox浏览器
   - 避免使用手机自带浏览器

3. **权限问题**：
   - 确保浏览器有摄像头访问权限
   - 如果首次拒绝，需要在手机设置中手动开启

4. **文件大小**：
   - 模型文件总大小约10MB
   - 通过微信/QQ发送时，注意文件大小限制

如果尝试了以上方法仍然无法解决问题，您可以考虑使用更专业的Web应用托管服务，如Netlify或Vercel，它们提供了更好的CDN支持和HTTPS环境。
